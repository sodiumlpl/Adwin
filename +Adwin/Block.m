classdef Block < handle
    %Block Summary of this class goes here
    %   Detailed explanation goes here
    
    properties
        
        parent_adwin    % parent Adwin class
       
        next            % next Block (empty if none)
        
    end
    
    properties % GUI structures
        
        bsg    % Block sequence GUI (digital)
        
        asg    % Block sequence GUI (analog)
        
        beg    % edit GUI digital outputs timing
        
        ebg    % edit Block sequence GUI
        
        aeg    % edit GUI analog outputs timing
        
        avg    % edit GUI analog outputs voltage
        
        abg    % analog behaviour GUI
        
    end
    
    properties % Sequences

        dig_out_struct % structure containing the digital outputs timing sequence
        
        ana_out_struct % structure containing the digital outputs timing sequence
        
    end
    
    properties
        
        t_start
        
        name
        
    end
    
    properties % Show
       
        dig_out_show
        
    end
    
    methods
        
        function obj = Block ()
            
            obj = obj@handle;
            
            % Initialize digital outputs structure
            
            timings_array_init=cell(1,Adwin.Default_parameters.dig_out_nbr);
            
            for i =1:Adwin.Default_parameters.dig_out_nbr;
            
            timings_array_init{i} = Adwin.Timing;
            
            timings_array_init{i}.type = 'digital';
            
            timings_array_init{i}.parent_block = obj;
            
            timings_array_init{i}.formula = 'Inf';
            
            timings_array_init{i}.abs_out = Inf;
            
            timings_array_init{i}.out = Inf;
            
            timings_array_init{i}.ord = 1;
            
            timings_array_init{i}.out_nbr = i;
            
            timings_array_init{i}.timing_nbr = 1;
            
            end
            
            obj.dig_out_struct = struct('name'           ,Adwin.Default_parameters.dig_out_name ...
                                       ,'timings_array'  ,timings_array_init ...
                                       );
            
            %%% Initialize analog outputs structures
            
            % Timings array
            
            timings_array_init=cell(1,Adwin.Default_parameters.ana_crd*Adwin.Default_parameters.ana_crd_out_nbr);
            
            for i =1:Adwin.Default_parameters.ana_crd*Adwin.Default_parameters.ana_crd_out_nbr;
                
                timings_array_init{i} = Adwin.Timing;
                
                timings_array_init{i}.type = 'analog';
                
                timings_array_init{i}.parent_block = obj;
                
                timings_array_init{i}.formula = 'Inf';
                
                timings_array_init{i}.abs_out = Inf;
                
                timings_array_init{i}.out = Inf;
                
                timings_array_init{i}.ord = 1;
                
                timings_array_init{i}.out_nbr = i;
                
                timings_array_init{i}.timing_nbr = 1;
                
            end
            
            % Voltage array
            
            voltages_array_init=cell(1,Adwin.Default_parameters.ana_crd*Adwin.Default_parameters.ana_crd_out_nbr);
            
            for i =1:Adwin.Default_parameters.ana_crd*Adwin.Default_parameters.ana_crd_out_nbr;
                
                voltages_array_init{i} = Adwin.Voltage;
                
                voltages_array_init{i}.parent_block = obj;
                
                voltages_array_init{i}.out_nbr = i;
                
                voltages_array_init{i}.value_formula = num2str(Adwin.Default_parameters.ana_out_init{i});
                
                voltages_array_init{i}.behaviour = 'C';
                
                voltages_array_init{i}.voltage_nbr = 1;
                
            end
            
            obj.ana_out_struct = struct('name'           ,Adwin.Default_parameters.ana_out_name ...
                ,'timings_array'  ,timings_array_init ...
                ,'voltages_array' ,voltages_array_init ...
                );
            
            obj.dig_out_show = zeros(1,Adwin.Default_parameters.dig_out_nbr);
            
        end
        
        function blk_seq_gui(obj,~,~)
            
            %%% Create GUI for the digital outputs sequence
            
            if ~isempty(obj.bsg)&&ishandle(obj.bsg.h)&&strcmp(get(obj.bsg.h,'Name'),['Block ',obj.name,' : digital sequence'])
                
                set(obj.bsg.h,'Visible','on');
                
            else
                
                obj.bsg.h = figure(...
                    'Name'                ,['Block ',obj.name,' : digital sequence'] ...
                    ,'NumberTitle'        ,'off' ...
                    ,'Position'           ,[8 48 1200 950] ... %,'MenuBar'     ,'none'...
                    ,'CloseRequestFcn'    ,@obj.bsg_closereq ...
                    );
                
                obj.bsg.hsp1 = uipanel(...
                    'Parent'              ,obj.bsg.h ...
                    ,'Title'              ,'Digital sequence' ...
                    ,'TitlePosition'      ,'lefttop' ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[0.015 0.015 0.97 0.97] ...
                    );
                
                for i=1:length(obj.dig_out_struct)
                    
                    % panels hsp2 geometry
                    
                    c_wth = 0.995;
                    r_wth = 0.03;
                    c_ofs = 0.0025;
                    r_ofs = (1-Adwin.Default_parameters.dig_out_nbr*r_wth)/(Adwin.Default_parameters.dig_out_nbr+1);
                    
                    eval(['obj.bsg.hsp2_',num2str(i),' = uipanel(', ...
                        '''Parent''              ,obj.bsg.hsp1', ...
                        ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                        ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                        ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                        ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                        ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                        ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                        ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                        ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                        ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                        ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                        ',''Position''           ,[c_ofs r_ofs+(i-1)*(r_wth+r_ofs) c_wth r_wth]', ...
                        ');']);
                    
                    % Checkbox geometry
                    
                    c_wth = 0.013;
                    c_ofs = 0.0025;
                    r_wth = 0.6;
                    r_ofs = 0.2;
                    
                    eval(['obj.bsg.ckb_',num2str(i),' = uicontrol(', ...
                        '''Parent''                ,obj.bsg.hsp2_',num2str(i), ...
                        ',''Style''                ,''checkbox''', ...
                        ',''Units''                ,Adwin.Default_parameters.Checkbox_Units', ...
                        ',''Value''                ,obj.dig_out_show(',num2str(i),')', ...
                        ',''Position''             ,[c_ofs r_ofs c_wth r_wth]', ...
                        ',''Tag''                 ,','''tag_',num2str(i),'''', ...
                        ',''Callback''             ,@obj.bsg_ckb_i_clb', ...
                        ');']);
                    
                    % Digital outputs name geometry
                    
                    c_wth = 0.11;
                    r_wth = 0.6;
                    c_ofs = 0.02;
                    r_ofs = 0.2;
                    
                    eval(['obj.bsg.txt_',num2str(i),' = uicontrol(', ...
                        '''Parent''                ,obj.bsg.hsp2_',num2str(i), ...
                        ',''Style''                ,''text''', ...
                        ',''String''               ,Adwin.Default_parameters.dig_out_name(i)', ...
                        ',''FontName''             ,Adwin.Default_parameters.Text_FontName', ...
                        ',''FontSize''             ,Adwin.Default_parameters.Text_FontSize', ...
                        ',''FontUnits''            ,Adwin.Default_parameters.Text_FontUnits', ...
                        ',''FontWeight''           ,Adwin.Default_parameters.Text_FontWeight', ...
                        ',''HorizontalAlignment''  ,''left''', ...
                        ',''Units''                ,Adwin.Default_parameters.Text_Units', ...
                        ',''Position''             ,[c_ofs r_ofs c_wth r_wth]', ...
                        ');']);
                    
                    
                    for j=1:length(obj.dig_out_struct(i).timings_array)
                        
                        % Digital outputs hsp2_i_j panels geometry
                        
                        c_start_ofs = 0.13;
                        c_wth = 0.04;
                        r_wth = 0.995;
                        c_ofs = 0.0025;
                        r_ofs = 0.0025;
                        
                        eval(['obj.bsg.hsp2_',num2str(i),'_',num2str(j),' = uipanel(', ...
                            '''Parent''              ,obj.bsg.hsp2_',num2str(i), ...
                            ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                            ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                            ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                            ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                            ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                            ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                            ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                            ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                            ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                            ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                            ',''Position''           ,[c_start_ofs+(j-1)*(c_wth+c_ofs) r_ofs c_wth r_wth]', ...
                            ');']);
                        

                        eval(['obj.bsg.text',num2str(i),'_',num2str(j),' = uicontrol(', ...
                            '''Parent''               ,obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''Style''               ,''text''', ...
                            ',''String''              ,num2str(obj.dig_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))', ...
                            ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                            ',''Position''            ,[0.05 0.05 0.95 0.8]',  ...
                            ',''ButtonDownFcn''       ,@obj.blk_edit_btd_fcn', ...
                            ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                            ');']);
                        
                        switch obj.dig_out_struct(i).timings_array(j).state
                            
                            case 1
                                
                                eval(['set(obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                                    ',''HighlightColor''               ,[0.0 1.0 0.0]', ...
                                    ');']);
                                
                            case 0
                                
                                eval(['set(obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                                    ',''HighlightColor''               ,[1.0 0.0 0.0]', ...
                                    ');']);
                                
                        end
                        
                    end
                    
                end
                
                % panel hsp3 geometry
                
                c_ofs = 0.9;
                r_ofs = 0.975;
                c_wth = 0.05;
                r_wth = 0.0225;
                
                obj.bsg.hsp3 = uipanel(...
                    'Parent'              ,obj.bsg.h ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % pushbutton 3_1 geometry
            
            c_ofs = 0.0025;
            r_ofs = 0.0025;
            c_wth = 0.995;
            r_wth = 0.995;
            
            obj.bsg.but3_1 = uicontrol(...
                'Parent'                ,obj.bsg.hsp3 ...
                ,'Style'                ,'pushbutton' ...
                ,'String'               ,'Show' ...
                ,'FontName'             ,Adwin.Default_parameters.Pushbutton_FontName ...
                ,'FontSize'             ,Adwin.Default_parameters.Pushbutton_FontSize ...
                ,'FontUnits'            ,Adwin.Default_parameters.Pushbutton_FontUnits ...
                ,'FontWeight'           ,Adwin.Default_parameters.Pushbutton_FontWeight ...
                ,'Units'                ,Adwin.Default_parameters.Pushbutton_Units ...
                ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                ,'Callback'             ,@obj.bsg_but3_1_clb ...
                );
                
            end
            
            % Create GUI for the analog outputs sequence
            
            if ~isempty(obj.asg)&&ishandle(obj.asg.h)&&strcmp(get(obj.asg.h,'Name'),['Block ',obj.name,' : analog sequence'])
                
                set(obj.asg.h,'Visible','on');
                
            else
                
                obj.asg.h = figure(...
                    'Name'                ,['Block ',obj.name,' : analog sequence'] ...
                    ,'NumberTitle'        ,'off' ...
                    ,'Position'           ,[716 48 1200 950] ... %,'MenuBar'     ,'none'...
                    ,'CloseRequestFcn'    ,@obj.asg_closereq ...
                    );
                
                obj.asg.hsp1 = uipanel(...
                    'Parent'              ,obj.asg.h ...
                    ,'Title'              ,'Analog sequence' ...
                    ,'TitlePosition'      ,'lefttop' ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[0.015 0.015 0.97 0.97] ...
                    );
                
                for i=1:length(obj.ana_out_struct)
                    
                    % panels hsp2 geometry
                    
                    c_wth = 0.995;
                    r_wth = 0.06;
                    c_ofs = 0.0025;
                    r_ofs = (1-Adwin.Default_parameters.ana_crd*Adwin.Default_parameters.ana_crd_out_nbr*r_wth)/(Adwin.Default_parameters.ana_crd*Adwin.Default_parameters.ana_crd_out_nbr+1);
                    
                    eval(['obj.asg.hsp2_',num2str(i),' = uipanel(', ...
                        '''Parent''              ,obj.asg.hsp1', ...
                        ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                        ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                        ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                        ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                        ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                        ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                        ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                        ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                        ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                        ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                        ',''Position''           ,[c_ofs r_ofs+(i-1)*(r_wth+r_ofs) c_wth r_wth]', ...
                        ');']);
                    
                    % Analog outputs name geometry
                    
                    c_wth = 0.12;
                    r_wth = 0.3;
                    c_ofs = 0.0025;
                    r_ofs = 0.35;
                    
                    eval(['obj.asg.txt_',num2str(i),' = uicontrol(', ...
                        '''Parent''                ,obj.asg.hsp2_',num2str(i), ...
                        ',''Style''                ,''text''', ...
                        ',''String''               ,Adwin.Default_parameters.ana_out_name{i}', ...
                        ',''FontName''             ,Adwin.Default_parameters.Text_FontName', ...
                        ',''FontSize''             ,Adwin.Default_parameters.Text_FontSize', ...
                        ',''FontUnits''            ,Adwin.Default_parameters.Text_FontUnits', ...
                        ',''FontWeight''           ,Adwin.Default_parameters.Text_FontWeight', ...
                        ',''HorizontalAlignment''  ,''left''', ...
                        ',''Units''                ,Adwin.Default_parameters.Text_Units', ...
                        ',''Position''             ,[c_ofs r_ofs c_wth r_wth]', ...
                        ');']);
                    
                    
                    for j=1:length(obj.ana_out_struct(i).timings_array)
                        
                        % Analog outputs hsp2_i_j panels geometry
                        
                        c_start_ofs = 0.13;
                        c_wth = 0.06;
                        r_wth = 0.995;
                        c_ofs = 0.0025;
                        r_ofs = 0.0025;
                        
                        eval(['obj.asg.hsp2_',num2str(i),'_',num2str(j),' = uipanel(', ...
                            '''Parent''              ,obj.asg.hsp2_',num2str(i), ...
                            ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                            ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                            ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                            ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                            ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                            ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                            ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                            ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                            ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                            ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                            ',''Position''           ,[c_start_ofs+(j-1)*(c_wth+c_ofs) r_ofs c_wth r_wth]', ...
                            ');']);
                        
                        % Analog outputs hsp3_i_j panels geometry
                        
                        c_wth = 0.595;
                        r_wth = 0.495;
                        c_ofs = 0.0025;
                        r_ofs = 0.5025;
                        
                        eval(['obj.asg.hsp3_',num2str(i),'_',num2str(j),' = uipanel(', ...
                            '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                            ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                            ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                            ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                            ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                            ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                            ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                            ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                            ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                            ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                            ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                            ');']);
                        
                        % Analog outputs text timings geometry
                        
                        c_wth = 0.95;
                        r_wth = 0.8;
                        c_ofs = 0.05;
                        r_ofs = 0.05;
                        
                        eval(['obj.asg.text3',num2str(i),'_',num2str(j),' = uicontrol(', ...
                            '''Parent''               ,obj.asg.hsp3_',num2str(i),'_',num2str(j), ...
                            ',''Style''               ,''text''', ...
                            ',''String''              ,num2str(obj.ana_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))', ...
                            ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                            ',''Position''            ,[c_ofs r_ofs c_wth r_wth]',  ...
                            ',''ButtonDownFcn''       ,@obj.ana_time_btd_fcn', ...
                            ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                            ');']);
                        % Analog outputs but_i_j panels geometry
                        
                        c_wth = 0.395;
                        r_wth = 0.495;
                        c_ofs = 0.6025;
                        r_ofs = 0.5025;
                        
                        eval(['obj.asg.but_',num2str(i),'_',num2str(j),' = uicontrol(', ...
                            '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''Style''               ,''pushbutton''', ...
                            ',''String''              ,''',obj.ana_out_struct(i).voltages_array(j).behaviour,'''', ...
                            ',''FontName''            ,Adwin.Default_parameters.Pushbutton_FontName', ...
                            ',''FontSize''            ,Adwin.Default_parameters.Pushbutton_FontSize', ...
                            ',''FontUnits''           ,Adwin.Default_parameters.Pushbutton_FontUnits', ...
                            ',''FontWeight''          ,Adwin.Default_parameters.Pushbutton_FontWeight', ...
                            ',''Units''               ,Adwin.Default_parameters.Pushbutton_Units', ...
                            ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                            ',''Callback''           ,@obj.asg_but_i_j_clb', ...
                            ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                            ');']);
                        
                        % Analog outputs hsp4_i_j panels geometry
                        
                        c_wth = 0.995;
                        r_wth = 0.495;
                        c_ofs = 0.0025;
                        r_ofs = 0.0025;
                        
                        eval(['obj.asg.hsp4_',num2str(i),'_',num2str(j),' = uipanel(', ...
                            '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                            ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                            ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                            ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                            ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                            ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                            ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                            ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                            ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                            ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                            ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                            ');']);
                        
                        % Analog outputs text voltages geometry
                        
                        c_wth = 0.95;
                        r_wth = 0.8;
                        c_ofs = 0.05;
                        r_ofs = 0.05;
                        
                        eval(['obj.asg.text4',num2str(i),'_',num2str(j),' = uicontrol(', ...
                            '''Parent''               ,obj.asg.hsp4_',num2str(i),'_',num2str(j), ...
                            ',''Style''               ,''text''', ...
                            ',''String''              ,num2str(obj.ana_out_struct(i).voltages_array(j).value)', ...
                            ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                            ',''Position''            ,[c_ofs r_ofs c_wth r_wth]',  ...
                            ',''ButtonDownFcn''       ,@obj.ana_volt_btd_fcn', ...
                            ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                            ');']);
                        
                    end
                    
                end
                
            end

        end
        
        function bsg_ckb_i_clb(obj,~,~)
            
            tag_txt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_txt,'_','split');
            
            i=str2double(split_tag{2});
            
            obj.dig_out_show(i) = eval(['get(obj.bsg.ckb_',num2str(i),',''Value'');']);
            
        end
        
        function bsg_but3_1_clb(obj,~,~)
            
            h_dig = figure(...
                 'Name'            ,'Digital Timings' ...
                ,'NumberTitle'     ,'off' ...
                ,'Position'        ,[8 48 1200 950] ...
                );
            
            ax_dig = axes(...
                 'Parent'           ,h_dig...
                ,'NextPlot'         ,'Add'...
                );
            
            cmap = colormap('lines');
            
            show_vec = find(obj.dig_out_show);
            
            len_show = length(show_vec);
            
            x_data = cell(1,len_show);
            y_data = cell(1,len_show);
            
            tmp_end = 0;
            cnt = 1;
            
            for l=show_vec
                
                tmp = [obj.dig_out_struct(l).timings_array.out]*evalin('base','Adwin_time_resol');
                
                x_data{l} = zeros(1,2*length(tmp));
                y_data{l} = zeros(1,2*length(tmp));
                
                y_data{l}(1) = obj.dig_out_struct(l).timings_array(1).state;
                
                for i=1:(length(tmp)-1)
                    
                    x_data{l}(2*i) = x_data{l}(2*i-1)+tmp(i);
                    x_data{l}(2*i+1) = x_data{l}(2*i);
                    
                    y_data{l}(2*i) = y_data{l}(2*i-1);
                    y_data{l}(2*i+1) = 1-y_data{l}(2*i);
                    
                end
                
                tmp_end = max(tmp_end,1.1*x_data{l}(end-1));
                y_data{l}(end) = y_data{l}(end-1);
                
                y_data{l} = y_data{l} + 2*(cnt-1);
                
                cnt = cnt+1;
                
            end
            
            cnt = 1;
            
            for l=show_vec
                
                x_data{l}(end) = tmp_end;
                
                plot(ax_dig,x_data{l},y_data{l},'LineStyle','-','Color',cmap(2*l,:))
                
                text('Parent',ax_dig,'Units','normalized','Position',[0.5 1/sum(obj.dig_out_show)*(cnt-1)+1.2/sum(obj.dig_out_show)/2],...
                    'HorizontalAlignment','center','VerticalAlignment','top','Color',cmap(2*l,:),...
                    'String',obj.dig_out_struct(l).name)
                
                plot(ax_dig,linspace(0,tmp_end,10),ones(1,10)*2*(cnt-1),'LineStyle',':','Color',cmap(2*l,:))
                
                plot(ax_dig,linspace(0,tmp_end,10),ones(1,10)*2*cnt-1,'LineStyle',':','Color',cmap(2*l,:))
                
                xlim([0 tmp_end])
                ylim([0 2*len_show])
                xlabel('Time [ms]')
                ylabel('Digital Outputs States')
                
                cnt = cnt+1;
                
            end
            
            
        end
        
        function bsg_closereq(obj,~,~)
           
            delete(obj.bsg.h)
            
            obj.bsg = [];
            
        end
        
        function asg_but_i_j_clb(obj,~,~)
            
            tag_txt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_txt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            if ~isempty(obj.abg)&&ishandle(obj.abg.h)
                
                set(obj.abg.h,...
                    'Visible'               ,'on' ...
                    ,'Name'                 ,['Behaviour - Out ',num2str(i),'- Timing ',num2str(j)] ...
                    );
                
                set(obj.abg.uibutgp...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                switch obj.ana_out_struct(i).voltages_array(j).behaviour
                    
                    case 'C'
                        
                        set(obj.abg.rbt_1,'Value',1)
                        
                    case 'R'
                        
                        set(obj.abg.rbt_2,'Value',1)
                        
                    case 'S'
                        
                        set(obj.abg.rbt_3,'Value',1)
                        
                end
                
                
            else
                
                
                obj.abg.h = figure(...
                    'Name'                ,['Behaviour - Out ',num2str(i),'- Timing ',num2str(j)] ...
                    ,'NumberTitle'        ,'off' ...
                    ,'Position'           ,[200 200 290 200] ... ,'MenuBar'            ,'none'...
                    );
                
                obj.abg.hsp1 = uipanel(...
                    'Parent'              ,obj.abg.h ...
                    ,'Title'              ,'Behaviour' ...
                    ,'TitlePosition'      ,'lefttop' ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[0.015 0.015 0.97 0.97] ...
                    );
                
                obj.abg.uibutgp = uibuttongroup(...
                    'Parent'              ,obj.abg.hsp1 ...
                    ,'Units'              ,'normalized' ...
                    ,'Position'           ,[0.015 0.35 0.97 0.62] ...
                    ,'SelectionChangeFcn' ,@obj.abg_uibutgp_sel_chg_fcn ...
                    ,'Tag'                ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                obj.abg.rbt_1 = uicontrol(...
                    'Parent'                ,obj.abg.uibutgp ...
                    ,'Style'                ,'radiobutton' ...
                    ,'String'               ,'Constant' ...
                    ,'FontName'             ,Adwin.Default_parameters.Radiobutton_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Radiobutton_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Radiobutton_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Radiobutton_FontWeight ...
                    ,'Units'                ,Adwin.Default_parameters.Radiobutton_Units ...
                    ,'Position'             ,[0.015 0.75 0.3 0.2] ...
                    );
                
                obj.abg.rbt_2 = uicontrol(...
                    'Parent'                ,obj.abg.uibutgp ...
                    ,'Style'                ,'radiobutton' ...
                    ,'String'               ,'Ramp' ...
                    ,'FontName'             ,Adwin.Default_parameters.Radiobutton_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Radiobutton_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Radiobutton_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Radiobutton_FontWeight ...
                    ,'Units'                ,Adwin.Default_parameters.Radiobutton_Units ...
                    ,'Position'             ,[0.015 0.4 0.3 0.2] ...
                    );
                
                obj.abg.rbt_3 = uicontrol(...
                    'Parent'                ,obj.abg.uibutgp ...
                    ,'Style'                ,'radiobutton' ...
                    ,'String'               ,'Custom' ...
                    ,'FontName'             ,Adwin.Default_parameters.Radiobutton_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Radiobutton_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Radiobutton_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Radiobutton_FontWeight ...
                    ,'Units'                ,Adwin.Default_parameters.Radiobutton_Units ...
                    ,'Position'             ,[0.015 0.05 0.3 0.2] ...
                    );
                
                obj.abg.txt1 = uicontrol(...
                'Parent'                ,obj.abg.hsp1 ...
                ,'Style'                ,'text' ...
                ,'String'               ,'Custom function name' ...
                ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                ,'Position'             ,[0.05 0.12 0.50 0.1] ...
                ,'Enable'               ,'off' ...
                );
            
            obj.abg.edt1 = uicontrol(...
                'Parent'                ,obj.abg.hsp1 ...
                ,'Style'                ,'edit' ...
                ,'String'               ,'' ...
                ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                ,'Position'             ,[0.6 0.1 0.35 0.15] ...
                ,'Enable'               ,'off' ... ,'Callback'             ,@obj.abg_edt1_clb ...
                );
                
                switch obj.ana_out_struct(i).voltages_array(j).behaviour
                    
                    case 'C'
                        
                        set(obj.abg.rbt_1,'Value',1)
                        
                    case 'R'
                        
                        set(obj.abg.rbt_2,'Value',1)
                        
                    case 'S'
                        
                        set(obj.abg.rbt_3,'Value',1)
                        
                        set(obj.abg.txt1,'Enable','on')
                        set(obj.abg.edt1,'Enable','on')
                        
                end
                
            end
            
        end
        
        function asg_closereq(obj,~,~)
           
            delete(obj.asg.h)
            
            obj.asg = [];
            
        end
        
        function abg_uibutgp_sel_chg_fcn(obj,source,eventdata)
            
            tag_txt=get(source,'Tag');
            
            split_tag=regexp(tag_txt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            switch get(eventdata.NewValue,'String')
                
                case 'Constant'
                    
                    obj.ana_out_struct(i).voltages_array(j).behaviour = 'C';
                    
                    eval(['set(obj.asg.but_',num2str(i),'_',num2str(j), ...
                        ',''String''              ,''',obj.ana_out_struct(i).voltages_array(j).behaviour,'''', ...
                        ');']);
                    
                    set(obj.abg.txt1,'Enable','off')
                    set(obj.abg.edt1,'Enable','off')
                    
                case 'Ramp'
                    
                    obj.ana_out_struct(i).voltages_array(j).behaviour = 'R';
                    
                    eval(['set(obj.asg.but_',num2str(i),'_',num2str(j), ...
                        ',''String''              ,''',obj.ana_out_struct(i).voltages_array(j).behaviour,'''', ...
                        ');']);
                    
                    set(obj.abg.txt1,'Enable','off')
                    set(obj.abg.edt1,'Enable','off')
                    
                case 'Custom'
                    
                    obj.ana_out_struct(i).voltages_array(j).behaviour = 'S';
                    
                    eval(['set(obj.asg.but_',num2str(i),'_',num2str(j), ...
                        ',''String''              ,''',obj.ana_out_struct(i).voltages_array(j).behaviour,'''', ...
                        ');']);
                    
                    set(obj.abg.txt1,'Enable','on')
                    set(obj.abg.edt1,'Enable','on')
                    
            end
            
        end
        
        function blk_seq_edit_btd_fcn(obj,~,~)
            
            obj.ebg.h = figure(...
                'Name'                ,['Edit Block : ',obj.name] ...
                ,'NumberTitle'        ,'off' ...
                ,'Position'           ,[200 200 200 200] ...
                ,'MenuBar'            ,'none'...
                );
            
            obj.ebg.hsp1 = uipanel(...
                'Parent'              ,obj.ebg.h ...
                ,'Title'              ,'Block Properties' ...
                ,'TitlePosition'      ,'lefttop' ...
                ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                ,'Position'           ,[0.015 0.015 0.97 0.97] ...
                );
            
            obj.ebg.txt1 = uicontrol(...
                'Parent'                ,obj.ebg.hsp1 ...
                ,'Style'                ,'text' ...
                ,'String'               ,'Name' ...
                ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                ,'Position'             ,[0.05 0.8 0.40 0.15] ...
                );
            
            obj.ebg.edt1 = uicontrol(...
                'Parent'                ,obj.ebg.hsp1 ...
                ,'Style'                ,'edit' ...
                ,'String'               ,obj.name ...
                ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                ,'Position'             ,[0.55 0.8 0.40 0.15] ...
                ,'Callback'             ,@obj.ebg_edt1_clb ...
                );
            
            obj.ebg.txt2 = uicontrol(...
                'Parent'                ,obj.ebg.hsp1 ...
                ,'Style'                ,'text' ...
                ,'String'               ,'Start Formula' ...
                ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                ,'Position'             ,[0.05 0.6 0.40 0.15] ...
                );
            
            obj.ebg.edt2 = uicontrol(...
                'Parent'                ,obj.ebg.hsp1 ...
                ,'Style'                ,'edit' ...
                ,'String'               ,obj.t_start ...
                ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                ,'Position'             ,[0.55 0.6 0.40 0.15] ...
                ,'Callback'             ,@obj.ebg_edt2_clb ...
                );
            
        end
        
        function ebg_edt1_clb(obj,~,~)
            
            obj.name = get(obj.ebg.edt1,'String');
            
        end
        
        function ebg_edt2_clb(obj,~,~)
            
            obj.t_start = get(obj.ebg.edt2,'String');
            
            obj.parent_adwin.seq_changed = 1;
            
        end
        
        function blk_edit_btd_fcn(obj,~,~)
            
            tag_txt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_txt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            if ~isempty(obj.beg)&&ishandle(obj.beg.h)
                
                set(obj.beg.h,...
                    'Visible'               ,'on' ...
                    ,'Name'                 ,['Out ',num2str(i),'- Timing ',num2str(j)] ...
                    );
                
                set(obj.beg.edt1 ...
                    ,'String'               ,obj.dig_out_struct(i).timings_array(j).formula ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                set(obj.beg.txt4,'String',num2str(obj.dig_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')));
                
                if ~isequal(obj.dig_out_struct(i).timings_array(j).out,Inf)
                    
                    set(obj.beg.txt6,'String',num2str(obj.dig_out_struct(i).timings_array(j).out));
                    
                else
                    
                    set(obj.beg.txt6,'String','Inf');
                    
                end
                
                if ~isempty(obj.dig_out_struct(i).timings_array(j).time_ref)
                    
                    set(obj.beg.edt2 ...
                        ,'String'             ,obj.dig_out_struct(i).timings_array(j).time_ref.ord ...
                        ,'Tag'                ,['tag_',num2str(i),'_',num2str(j)] ...
                        );
                    
                else
                    
                    set(obj.beg.edt2 ...
                        ,'String'             ,'' ...
                        ,'Tag'                ,['tag_',num2str(i),'_',num2str(j)] ...
                        );
                    
                end
                
            else
                
                
                obj.beg.h = figure(...
                    'Name'                ,['Out ',num2str(i),'- Timing ',num2str(j)] ...
                    ,'NumberTitle'        ,'off' ...
                    ,'Position'           ,[200 200 200 200] ...
                    ,'MenuBar'            ,'none'...
                    );
                
                obj.beg.hsp1 = uipanel(...
                    'Parent'              ,obj.beg.h ...
                    ,'Title'              ,'Timing' ...
                    ,'TitlePosition'      ,'lefttop' ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[0.015 0.015 0.97 0.97] ...
                    );
                
                obj.beg.txt1 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Formula' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.8 0.40 0.15] ...
                    );
                
                obj.beg.edt1 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'edit' ...
                    ,'String'               ,obj.dig_out_struct(i).timings_array(j).formula ...
                    ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                    ,'Position'             ,[0.55 0.8 0.40 0.15] ...
                    ,'Callback'             ,@obj.beg_edt1_clb ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                obj.beg.txt2 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Timing Reference' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.6 0.40 0.15] ...
                    );
                
                obj.beg.edt2 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'edit' ...
                    ,'String'               ,'' ...
                    ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                    ,'Position'             ,[0.55 0.6 0.40 0.15] ...
                    ,'Callback'             ,@obj.beg_edt2_clb ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                                
                if ~isempty(obj.dig_out_struct(i).timings_array(j).time_ref)
                    
                    set(obj.beg.edt2,'String',obj.dig_out_struct(i).timings_array(j).time_ref.ord);
                    
                end
                
                obj.beg.txt3 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Timing' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.4 0.40 0.15] ...
                    );
                
                obj.beg.txt4 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,num2str(obj.dig_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')) ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.55 0.4 0.40 0.15] ...
                    );
                
                obj.beg.txt5 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Timing steps' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.2 0.40 0.15] ...
                    );
                
                obj.beg.txt6 = uicontrol(...
                    'Parent'                ,obj.beg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.55 0.2 0.40 0.15] ...
                    );
                
                if ~isequal(obj.dig_out_struct(i).timings_array(j).out,Inf)
                    
                    set(obj.beg.txt6,'String',num2str(obj.dig_out_struct(i).timings_array(j).out));
                    
                else
                    
                    set(obj.beg.txt6,'String','Inf');
                    
                end
                
            end
            
        end
        
        function ana_time_btd_fcn(obj,~,~)
            
            tag_txt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_txt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            if ~isempty(obj.aeg)&&ishandle(obj.aeg.h)
                
                set(obj.aeg.h,...
                    'Visible'               ,'on' ...
                    ,'Name'                 ,[Adwin.Default_parameters.ana_out_name{i},' - Timing ',num2str(j)] ...
                    );
                
                set(obj.aeg.edt1 ...
                    ,'String'               ,obj.ana_out_struct(i).timings_array(j).formula ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                set(obj.aeg.txt4,'String',num2str(obj.ana_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')));
                
                if ~isequal(obj.ana_out_struct(i).timings_array(j).out,Inf)
                    
                    set(obj.aeg.txt6,'String',num2str(obj.ana_out_struct(i).timings_array(j).out));
                    
                else
                    
                    set(obj.aeg.txt6,'String','Inf');
                    
                end
                
                if ~isempty(obj.ana_out_struct(i).timings_array(j).time_ref)
                    
                    set(obj.aeg.edt2 ...
                        ,'String'             ,obj.ana_out_struct(i).timings_array(j).time_ref.ord ...
                        ,'Tag'                ,['tag_',num2str(i),'_',num2str(j)] ...
                        );
                    
                else
                    
                    set(obj.aeg.edt2 ...
                        ,'String'             ,'' ...
                        ,'Tag'                ,['tag_',num2str(i),'_',num2str(j)] ...
                        );
                    
                end
                
            else
                
                
                obj.aeg.h = figure(...
                    'Name'                ,[Adwin.Default_parameters.ana_out_name{i},' - Timing ',num2str(j)] ...
                    ,'NumberTitle'        ,'off' ...
                    ,'Position'           ,[200 200 200 200] ...
                    ,'MenuBar'            ,'none'...
                    );
                
                obj.aeg.hsp1 = uipanel(...
                    'Parent'              ,obj.aeg.h ...
                    ,'Title'              ,'Timing' ...
                    ,'TitlePosition'      ,'lefttop' ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[0.015 0.015 0.97 0.97] ...
                    );
                
                obj.aeg.txt1 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Formula' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.8 0.40 0.15] ...
                    );
                
                obj.aeg.edt1 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'edit' ...
                    ,'String'               ,obj.ana_out_struct(i).timings_array(j).formula ...
                    ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                    ,'Position'             ,[0.55 0.8 0.40 0.15] ...
                    ,'Callback'             ,@obj.aeg_edt1_clb ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                obj.aeg.txt2 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Timing Reference' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.6 0.40 0.15] ...
                    );
                
                obj.aeg.edt2 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'edit' ...
                    ,'String'               ,'' ...
                    ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                    ,'Position'             ,[0.55 0.6 0.40 0.15] ...
                    ,'Callback'             ,@obj.aeg_edt2_clb ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                if ~isempty(obj.ana_out_struct(i).timings_array(j).time_ref)
                    
                    set(obj.aeg.edt2,'String',obj.ana_out_struct(i).timings_array(j).time_ref.ord);
                    
                end
                
                obj.aeg.txt3 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Timing' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.4 0.40 0.15] ...
                    );
                
                obj.aeg.txt4 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')) ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.55 0.4 0.40 0.15] ...
                    );

                obj.aeg.txt5 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Timing steps' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.05 0.2 0.40 0.15] ...
                    );
                
                obj.aeg.txt6 = uicontrol(...
                    'Parent'                ,obj.aeg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[0.55 0.2 0.40 0.15] ...
                    );
                
                if ~isequal(obj.ana_out_struct(i).timings_array(j).out,Inf)
                    
                    set(obj.aeg.txt6,'String',num2str(obj.ana_out_struct(i).timings_array(j).out));
                    
                else
                    
                    set(obj.aeg.txt6,'String','Inf');
                    
                end
                
            end
            
        end
        
        function aeg_edt1_clb(obj,~,~)
            
            tag_edt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_edt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            obj.ana_out_struct(i).timings_array(j).formula = get(obj.aeg.edt1,'String');
            
            eval(['set(obj.asg.text3',num2str(i),'_',num2str(j),',''String'',num2str(obj.ana_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))',');']);
            
            set(obj.aeg.txt4,'String',num2str(obj.ana_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')));
            
            if ~isequal(obj.ana_out_struct(i).timings_array(j).out,Inf)
                
                set(obj.aeg.txt6,'String',num2str(obj.ana_out_struct(i).timings_array(j).out));
                
            else
                
                set(obj.aeg.txt6,'String','Inf');
                
            end
            
            if j == length(obj.ana_out_struct(i).timings_array)
                
                obj.ana_out_struct(i).timings_array(end+1) = Adwin.Timing;
                
                obj.ana_out_struct(i).timings_array(end).type = 'analog';
                
                obj.ana_out_struct(i).timings_array(end).parent_block = obj;
                
                obj.ana_out_struct(i).timings_array(end).ord = length(obj.ana_out_struct(i).timings_array);
                
                obj.ana_out_struct(i).timings_array(end).previous = obj.ana_out_struct(i).timings_array(end-1);
                
                obj.ana_out_struct(i).timings_array(end).out_nbr = obj.ana_out_struct(i).timings_array(end-1).out_nbr;
                
                obj.ana_out_struct(i).timings_array(end).timing_nbr = obj.ana_out_struct(i).timings_array(end-1).timing_nbr+1;
                
                obj.ana_out_struct(i).timings_array(end-1).next = obj.ana_out_struct(i).timings_array(end);
                
                obj.ana_out_struct(i).voltages_array(end+1) = Adwin.Voltage;
                
                obj.ana_out_struct(i).voltages_array(end).parent_block = obj;
                
                obj.ana_out_struct(i).voltages_array(end).out_nbr = obj.ana_out_struct(i).voltages_array(end-1).out_nbr;
                
                obj.ana_out_struct(i).voltages_array(end).voltage_nbr = obj.ana_out_struct(i).voltages_array(end-1).voltage_nbr+1;
                
                obj.ana_out_struct(i).voltages_array(end).behaviour = 'C';
                
                j=j+1;
                
                % Analog outputs hsp2_i_j panels geometry
                
                c_start_ofs = 0.13;
                c_wth = 0.06;
                r_wth = 0.995;
                c_ofs = 0.0025;
                r_ofs = 0.0025;
                
                eval(['obj.asg.hsp2_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_start_ofs+(j-1)*(c_wth+c_ofs) r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs hsp3_i_j panels geometry
                
                c_wth = 0.595;
                r_wth = 0.495;
                c_ofs = 0.0025;
                r_ofs = 0.5025;
                
                eval(['obj.asg.hsp3_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs text timings geometry
                
                c_wth = 0.95;
                r_wth = 0.8;
                c_ofs = 0.05;
                r_ofs = 0.05;
                
                eval(['obj.asg.text3',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''               ,obj.asg.hsp3_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''text''', ...
                    ',''String''              ,num2str(obj.ana_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))', ...
                    ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                    ',''Position''            ,[c_ofs r_ofs c_wth r_wth]',  ...
                    ',''ButtonDownFcn''       ,@obj.ana_time_btd_fcn', ...
                    ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                    ');']);

                % Analog outputs but_i_j panels geometry
                
                c_wth = 0.395;
                r_wth = 0.495;
                c_ofs = 0.6025;
                r_ofs = 0.5025;
                
                eval(['obj.asg.but_',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''pushbutton''', ...
                    ',''String''              ,''',obj.ana_out_struct(i).voltages_array(j).behaviour,'''', ...
                    ',''FontName''            ,Adwin.Default_parameters.Pushbutton_FontName', ...
                    ',''FontSize''            ,Adwin.Default_parameters.Pushbutton_FontSize', ...
                    ',''FontUnits''           ,Adwin.Default_parameters.Pushbutton_FontUnits', ...
                    ',''FontWeight''          ,Adwin.Default_parameters.Pushbutton_FontWeight', ...
                    ',''Units''               ,Adwin.Default_parameters.Pushbutton_Units', ...
                    ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs hsp4_i_j panels geometry
                
                c_wth = 0.995;
                r_wth = 0.495;
                c_ofs = 0.0025;
                r_ofs = 0.0025;
                
                eval(['obj.asg.hsp4_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs text voltages geometry
                
                c_wth = 0.95;
                r_wth = 0.8;
                c_ofs = 0.05;
                r_ofs = 0.05;
                
                eval(['obj.asg.text4',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''               ,obj.asg.hsp4_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''text''', ...
                    ',''String''              ,num2str(obj.ana_out_struct(i).voltages_array(j).value)', ...
                    ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                    ',''Position''            ,[c_ofs r_ofs c_wth r_wth]',  ...
                    ',''ButtonDownFcn''       ,@obj.ana_volt_btd_fcn', ...
                    ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                    ');']);
                
                obj.ana_out_struct(i).timings_array(end).formula = 'Inf';
                
                obj.ana_out_struct(i).timings_array(end).abs_out = Inf;
                
                obj.ana_out_struct(i).timings_array(end).out = Inf;
                
                obj.ana_out_struct(i).voltages_array(end).value_formula = num2str(Adwin.Default_parameters.ana_out_init{i});
                
            end

            obj.parent_adwin.seq_changed = 1;
            
        end
        
        function aeg_edt2_clb(obj,~,~)
            
            tag_edt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_edt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            ord_ref = str2double(get(obj.aeg.edt2,'String'));
            
            obj.ana_out_struct(i).timings_array(j).time_ref = obj.ana_out_struct(i).timings_array(ord_ref);
            
            obj.ana_out_struct(i).timings_array(j).set_out;
            
            eval(['set(obj.asg.text3',num2str(i),'_',num2str(j),',''String'',num2str(obj.ana_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))',');']);
            
            set(obj.aeg.txt4,'String',num2str(obj.ana_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')));
            
            if ~isequal(obj.ana_out_struct(i).timings_array(j).out,Inf)
                
                set(obj.aeg.txt6,'String',num2str(obj.ana_out_struct(i).timings_array(j).out));
                
            else
                
                set(obj.aeg.txt6,'String','Inf');
                
            end
            
            if j == length(obj.ana_out_struct(i).timings_array)
                
                obj.ana_out_struct(i).timings_array(end+1) = Adwin.Timing;
                
                obj.ana_out_struct(i).timings_array(end).type = 'analog';
                
                obj.ana_out_struct(i).timings_array(end).parent_block = obj;
                
                obj.ana_out_struct(i).timings_array(end).ord = length(obj.ana_out_struct(i).timings_array);
                
                obj.ana_out_struct(i).timings_array(end).previous = obj.ana_out_struct(i).timings_array(end-1);
                
                obj.ana_out_struct(i).timings_array(end).out_nbr = obj.ana_out_struct(i).timings_array(end-1).out_nbr;
                
                obj.ana_out_struct(i).timings_array(end).timing_nbr = obj.ana_out_struct(i).timings_array(end-1).timing_nbr+1;
                
                obj.ana_out_struct(i).timings_array(end-1).next = obj.ana_out_struct(i).timings_array(end);
                
                obj.ana_out_struct(i).voltages_array(end+1) = Adwin.Voltage;
                
                obj.ana_out_struct(i).voltages_array(end).parent_block = obj;
                
                obj.ana_out_struct(i).voltages_array(end).out_nbr = obj.ana_out_struct(i).voltages_array(end-1).out_nbr;
                
                obj.ana_out_struct(i).voltages_array(end).voltage_nbr = obj.ana_out_struct(i).voltages_array(end-1).voltage_nbr+1;
                
                obj.ana_out_struct(i).voltages_array(end).behaviour = 'C';
                 
                j=j+1;
                
                % Analog outputs hsp2_i_j panels geometry
                
                c_start_ofs = 0.13;
                c_wth = 0.06;
                r_wth = 0.995;
                c_ofs = 0.0025;
                r_ofs = 0.0025;
                
                eval(['obj.asg.hsp2_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_start_ofs+(j-1)*(c_wth+c_ofs) r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs hsp3_i_j panels geometry
                
                c_wth = 0.595;
                r_wth = 0.495;
                c_ofs = 0.0025;
                r_ofs = 0.5025;
                
                eval(['obj.asg.hsp3_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs text timings geometry
                
                c_wth = 0.95;
                r_wth = 0.8;
                c_ofs = 0.05;
                r_ofs = 0.05;
                
                eval(['obj.asg.text3',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''               ,obj.asg.hsp3_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''text''', ...
                    ',''String''              ,num2str(obj.ana_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))', ...
                    ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                    ',''Position''            ,[c_ofs r_ofs c_wth r_wth]',  ...
                    ',''ButtonDownFcn''       ,@obj.ana_time_btd_fcn', ...
                    ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                    ');']);

                % Analog outputs but_i_j panels geometry
                
                c_wth = 0.395;
                r_wth = 0.495;
                c_ofs = 0.6025;
                r_ofs = 0.5025;
                
                eval(['obj.asg.but_',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''pushbutton''', ...
                    ',''String''              ,''',obj.ana_out_struct(i).voltages_array(j).behaviour,'''', ...
                    ',''FontName''            ,Adwin.Default_parameters.Pushbutton_FontName', ...
                    ',''FontSize''            ,Adwin.Default_parameters.Pushbutton_FontSize', ...
                    ',''FontUnits''           ,Adwin.Default_parameters.Pushbutton_FontUnits', ...
                    ',''FontWeight''          ,Adwin.Default_parameters.Pushbutton_FontWeight', ...
                    ',''Units''               ,Adwin.Default_parameters.Pushbutton_Units', ...
                    ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs hsp4_i_j panels geometry
                
                c_wth = 0.995;
                r_wth = 0.495;
                c_ofs = 0.0025;
                r_ofs = 0.0025;
                
                eval(['obj.asg.hsp4_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.asg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_ofs r_ofs c_wth r_wth]', ...
                    ');']);
                
                % Analog outputs text voltages geometry
                
                c_wth = 0.95;
                r_wth = 0.8;
                c_ofs = 0.05;
                r_ofs = 0.05;
                
                eval(['obj.asg.text4',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''               ,obj.asg.hsp4_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''text''', ...
                    ',''String''              ,num2str(obj.ana_out_struct(i).voltages_array(j).value)', ...
                    ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                    ',''Position''            ,[c_ofs r_ofs c_wth r_wth]',  ...
                    ',''ButtonDownFcn''       ,@obj.ana_volt_btd_fcn', ...
                    ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                    ');']);
                
                obj.ana_out_struct(i).timings_array(end).formula = 'Inf';
                
                obj.ana_out_struct(i).timings_array(end).abs_out = Inf;
                
                obj.ana_out_struct(i).timings_array(end).out = Inf;
                
                obj.ana_out_struct(i).voltages_array(end).value_formula = num2str(Adwin.Default_parameters.ana_out_init{i});
                
            end
             
            obj.parent_adwin.seq_changed = 1;
            
        end
        
        function ana_volt_btd_fcn(obj,~,~)
            
            tag_txt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_txt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            if ~isempty(obj.avg)&&ishandle(obj.avg.h)
                
                set(obj.avg.h,...
                    'Visible'               ,'on' ...
                    ,'Name'                 ,[Adwin.Default_parameters.ana_out_name{i},' - Voltage ',num2str(j)] ...
                    );
                
                set(obj.avg.edt1 ...
                    ,'String'               ,obj.ana_out_struct(i).voltages_array(j).value_formula ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                set(obj.avg.txt3 ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).voltages_array(j).voltage) ...
                    );
                
                set(obj.avg.txt5 ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).voltages_array(j).binary) ...
                    );
                
                set(obj.avg.txt7 ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).voltages_array(j).value) ...
                    );
                
            else
                
                
                obj.avg.h = figure(...
                    'Name'                ,[Adwin.Default_parameters.ana_out_name{i},' - Voltage ',num2str(j)] ...
                    ,'NumberTitle'        ,'off' ...
                    ,'Position'           ,[200 200 200 200] ...
                    ,'MenuBar'            ,'none'...
                    );
                
                % Analog voltage GUI panel geometry
                
                c_wth = 0.97;
                r_wth = 0.97;
                c_ofs = 0.015;
                r_ofs = 0.015;
                
                obj.avg.hsp1 = uipanel(...
                    'Parent'              ,obj.avg.h ...
                    ,'Title'              ,'Timing' ...
                    ,'TitlePosition'      ,'lefttop' ...
                    ,'BackgroundColor'    ,Adwin.Default_parameters.Panel_BackgroundColor ...
                    ,'ForegroundColor'    ,Adwin.Default_parameters.Panel_ForegroundColor ...
                    ,'HighlightColor'     ,Adwin.Default_parameters.Panel_HighlightColor ...
                    ,'ShadowColor'        ,Adwin.Default_parameters.Panel_ShadowColor ...
                    ,'FontName'           ,Adwin.Default_parameters.Panel_FontName ...
                    ,'FontSize'           ,Adwin.Default_parameters.Panel_FontSize ...
                    ,'FontUnits'          ,Adwin.Default_parameters.Panel_FontUnits ...
                    ,'FontWeight'         ,Adwin.Default_parameters.Panel_FontWeight ...
                    ,'SelectionHighlight' ,Adwin.Default_parameters.Panel_SelectionHighlight ...
                    ,'Units'              ,Adwin.Default_parameters.Panel_Units ...
                    ,'Position'           ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog value formula text geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.05;
                r_ofs = 0.8;
                
                obj.avg.txt1 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Value formula' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog value formula edit geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.55;
                r_ofs = 0.8;
                
                obj.avg.edt1 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'edit' ...
                    ,'String'               ,obj.ana_out_struct(i).voltages_array(j).value_formula ...
                    ,'Units'                ,Adwin.Default_parameters.Edit_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    ,'Callback'             ,@obj.avg_edt1_clb ...
                    ,'Tag'                  ,['tag_',num2str(i),'_',num2str(j)] ...
                    );
                
                % Analog voltage text 2 geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.05;
                r_ofs = 0.4;
                
                obj.avg.txt2 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Voltage' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog voltage text 3 geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.55;
                r_ofs = 0.4;
                
                obj.avg.txt3 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).voltages_array(j).voltage) ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog binary number text 4 geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.05;
                r_ofs = 0.2;
                
                obj.avg.txt4 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Binary number' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog binary number text 4 geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.55;
                r_ofs = 0.2;
                
                obj.avg.txt5 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).voltages_array(j).binary) ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog value text 6 geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.05;
                r_ofs = 0.6;
                
                obj.avg.txt6 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,'Value' ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,Adwin.Default_parameters.Text_FontWeight ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
                % Analog binary number text 7 geometry
                
                c_wth = 0.40;
                r_wth = 0.15;
                c_ofs = 0.55;
                r_ofs = 0.6;
                
                obj.avg.txt7 = uicontrol(...
                    'Parent'                ,obj.avg.hsp1 ...
                    ,'Style'                ,'text' ...
                    ,'String'               ,num2str(obj.ana_out_struct(i).voltages_array(j).value) ...
                    ,'FontName'             ,Adwin.Default_parameters.Text_FontName ...
                    ,'FontSize'             ,Adwin.Default_parameters.Text_FontSize ...
                    ,'FontUnits'            ,Adwin.Default_parameters.Text_FontUnits ...
                    ,'FontWeight'           ,'normal' ...
                    ,'HorizontalAlignment'  ,Adwin.Default_parameters.Text_HorizontalAlignment ...
                    ,'Units'                ,Adwin.Default_parameters.Text_Units ...
                    ,'Position'             ,[c_ofs r_ofs c_wth r_wth] ...
                    );
                
            end
            
        end
        
        function avg_edt1_clb(obj,~,~)
            
            tag_edt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_edt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            obj.ana_out_struct(i).voltages_array(j).value_formula = get(obj.avg.edt1,'String');
            
            set(obj.avg.txt3,'String',num2str(obj.ana_out_struct(i).voltages_array(j).voltage));
            
            set(obj.avg.txt5,'String',num2str(obj.ana_out_struct(i).voltages_array(j).binary));
            
            set(obj.avg.txt7,'String',num2str(obj.ana_out_struct(i).voltages_array(j).value));
            
            eval(['set(obj.asg.text4',num2str(i),'_',num2str(j),',''String'',num2str(obj.ana_out_struct(i).voltages_array(j).value)',');']);

            obj.parent_adwin.seq_changed = 1;
            
        end
        
        function beg_edt1_clb(obj,~,~)
            
            tag_edt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_edt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            obj.dig_out_struct(i).timings_array(j).formula = get(obj.beg.edt1,'String');
            
            eval(['set(obj.bsg.text',num2str(i),'_',num2str(j),',''String'',num2str(obj.dig_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))',');']);
            
            set(obj.beg.txt4,'String',num2str(obj.dig_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')));
            
            if ~isequal(obj.dig_out_struct(i).timings_array(j).out,Inf)
                
                set(obj.beg.txt6,'String',num2str(obj.dig_out_struct(i).timings_array(j).out));
                
            else
                
                set(obj.beg.txt6,'String','Inf');
                
            end
            
            if j == length(obj.dig_out_struct(i).timings_array)
                
                obj.dig_out_struct(i).timings_array(end+1) = Adwin.Timing;
                
                obj.dig_out_struct(i).timings_array(end).type = 'digital';
                
                obj.dig_out_struct(i).timings_array(end).parent_block = obj;
                
                obj.dig_out_struct(i).timings_array(end).ord = length(obj.dig_out_struct(i).timings_array);
                
                obj.dig_out_struct(i).timings_array(end).previous = obj.dig_out_struct(i).timings_array(end-1);
 
                obj.dig_out_struct(i).timings_array(end).out_nbr = obj.dig_out_struct(i).timings_array(end-1).out_nbr;
                
                obj.dig_out_struct(i).timings_array(end).timing_nbr = obj.dig_out_struct(i).timings_array(end-1).timing_nbr+1;
                
                obj.dig_out_struct(i).timings_array(end).state = ~obj.dig_out_struct(i).timings_array(end-1).state;
                
                obj.dig_out_struct(i).timings_array(end-1).next = obj.dig_out_struct(i).timings_array(end);
                
                j=j+1;
                
                % Digital outputs hsp2_i_j panels geometry
                
                c_start_ofs = 0.12;
                c_wth = 0.04;
                r_wth = 0.995;
                c_ofs = 0.0025;
                r_ofs = 0.0025;
                
                eval(['obj.bsg.hsp2_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.bsg.hsp2_',num2str(i), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_start_ofs+(j-1)*(c_wth+c_ofs) r_ofs c_wth r_wth]', ...
                    ');']);
                
                eval(['obj.bsg.text',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''               ,obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''text''', ...
                    ',''String''              ,num2str(obj.dig_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))', ...
                    ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                    ',''Position''            ,[0.05 0.05 0.95 0.8]',  ...
                    ',''ButtonDownFcn''       ,@obj.blk_edit_btd_fcn', ...
                    ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                    ');']);

                obj.dig_out_struct(i).timings_array(end).formula = 'Inf';
                
                obj.dig_out_struct(i).timings_array(end).abs_out = Inf;
                
                obj.dig_out_struct(i).timings_array(end).out = Inf;
                
                switch obj.dig_out_struct(i).timings_array(j).state
                    
                    case 1
                        
                        eval(['set(obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''HighlightColor''               ,[0.0 1.0 0.0]', ...
                            ');']);
                        
                    case 0
                        
                        eval(['set(obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''HighlightColor''               ,[1.0 0.0 0.0]', ...
                            ');']);
                        
                end
                
            end

            obj.parent_adwin.seq_changed = 1;
            
        end
        
        function beg_edt2_clb(obj,~,~)
            
            tag_edt=get(gcbo,'Tag');
            
            split_tag=regexp(tag_edt,'_','split');
            
            i=str2double(split_tag{2});
            j=str2double(split_tag{3});
            
            ord_ref = str2double(get(obj.beg.edt2,'String'));
            
            obj.dig_out_struct(i).timings_array(j).time_ref = obj.dig_out_struct(i).timings_array(ord_ref);
            
            obj.dig_out_struct(i).timings_array(j).set_out;
            
            eval(['set(obj.bsg.text',num2str(i),'_',num2str(j),',''String'',num2str(obj.dig_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))',');']);
            
            set(obj.beg.txt4,'String',num2str(obj.dig_out_struct(i).timings_array(j).out*evalin('base','Adwin_time_resol')));
            
            if ~isequal(obj.dig_out_struct(i).timings_array(j).out,Inf)
                
                set(obj.beg.txt6,'String',num2str(obj.dig_out_struct(i).timings_array(j).out));
                
            else
                
                set(obj.beg.txt6,'String','Inf');
                
            end
            
            if j == length(obj.dig_out_struct(i).timings_array)
                
                obj.dig_out_struct(i).timings_array(end+1) = Adwin.Timing;
                
                obj.dig_out_struct(i).timings_array(end).type = 'digital';
                
                obj.dig_out_struct(i).timings_array(end).parent_block = obj;
                
                obj.dig_out_struct(i).timings_array(end).ord = length(obj.dig_out_struct(i).timings_array);
                
                obj.dig_out_struct(i).timings_array(end).previous = obj.dig_out_struct(i).timings_array(end-1);
     
                obj.dig_out_struct(i).timings_array(end).out_nbr = obj.dig_out_struct(i).timings_array(end-1).out_nbr;
                
                obj.dig_out_struct(i).timings_array(end).timing_nbr = obj.dig_out_struct(i).timings_array(end-1).timing_nbr+1;
                
                obj.dig_out_struct(i).timings_array(end).state = ~obj.dig_out_struct(i).timings_array(end-1).state;
                
                obj.dig_out_struct(i).timings_array(end-1).next = obj.dig_out_struct(i).timings_array(end);
                
                j=j+1;
                
                % Digital outputs hsp2_i_j panels geometry
                
                c_start_ofs = 0.12;
                c_wth = 0.04;
                r_wth = 0.995;
                c_ofs = 0.0025;
                r_ofs = 0.0025;
                
                eval(['obj.bsg.hsp2_',num2str(i),'_',num2str(j),' = uipanel(', ...
                    '''Parent''              ,obj.bsg.hsp2_',num2str(i), ...
                    ',''BackgroundColor''    ,Adwin.Default_parameters.Panel_BackgroundColor', ...
                    ',''ForegroundColor''    ,Adwin.Default_parameters.Panel_ForegroundColor', ...
                    ',''HighlightColor''     ,Adwin.Default_parameters.Panel_HighlightColor', ...
                    ',''ShadowColor''        ,Adwin.Default_parameters.Panel_ShadowColor', ...
                    ',''FontName''           ,Adwin.Default_parameters.Panel_FontName', ...
                    ',''FontSize''           ,Adwin.Default_parameters.Panel_FontSize', ...
                    ',''FontUnits''          ,Adwin.Default_parameters.Panel_FontUnits', ...
                    ',''FontWeight''         ,Adwin.Default_parameters.Panel_FontWeight', ...
                    ',''SelectionHighlight'' ,Adwin.Default_parameters.Panel_SelectionHighlight', ...
                    ',''Units''              ,Adwin.Default_parameters.Panel_Units', ...
                    ',''Position''           ,[c_start_ofs+(j-1)*(c_wth+c_ofs) r_ofs c_wth r_wth]', ...
                    ');']);
                
                eval(['obj.bsg.text',num2str(i),'_',num2str(j),' = uicontrol(', ...
                    '''Parent''               ,obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                    ',''Style''               ,''text''', ...
                    ',''String''              ,num2str(obj.dig_out_struct(i).timings_array(j).out*evalin(''base'',''Adwin_time_resol''))', ...
                    ',''Units''               ,Adwin.Default_parameters.Text_Units', ...
                    ',''Position''            ,[0.05 0.05 0.95 0.8]',  ...
                    ',''ButtonDownFcn''       ,@obj.blk_edit_btd_fcn', ...
                    ',''Tag''                 ,','''tag_',num2str(i),'_',num2str(j),'''', ...
                    ');']);

                obj.dig_out_struct(i).timings_array(end).formula = 'Inf';
                
                obj.dig_out_struct(i).timings_array(end).abs_out = Inf;
                
                obj.dig_out_struct(i).timings_array(end).out = Inf;
                
                switch obj.dig_out_struct(i).timings_array(j).state
                    
                    case 1
                        
                        eval(['set(obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''HighlightColor''               ,[0.0 1.0 0.0]', ...
                            ');']);
                        
                    case 0
                        
                        eval(['set(obj.bsg.hsp2_',num2str(i),'_',num2str(j), ...
                            ',''HighlightColor''               ,[1.0 0.0 0.0]', ...
                            ');']);
                        
                end
                
            end
             
            obj.parent_adwin.seq_changed = 1;
            
        end
        
        function generate_script_file(obj,fid)
            
            %%% Digital outputs
            
            for i=1:length(obj.dig_out_struct)
                
                if length(obj.dig_out_struct(i).timings_array)>1
                    
                    fprintf(fid,['%%%%%%%% Digital : ',Adwin.Default_parameters.dig_out_name{i},' %%%%%%%%\n\n']);
                    
                end
                
                for j=1:length(obj.dig_out_struct(i).timings_array)-1
                    
                    if ~isempty(obj.dig_out_struct(i).timings_array(j).time_ref)
                    
                    fprintf(fid,['test_adwin.chge_state_dig(',num2str(i),',''',obj.name,''',',num2str(obj.dig_out_struct(i).timings_array(j).time_ref.ord),',''',obj.dig_out_struct(i).timings_array(j).formula,''');\n\n']);
                    
                    else
                        
                        fprintf(fid,['test_adwin.chge_state_dig(',num2str(i),',''',obj.name,''',[],''',obj.dig_out_struct(i).timings_array(j).formula,''');\n\n']);
                        
                    end
                    
                end
                
            end
            
            %%% Analog outputs
            
            for i=1:length(obj.ana_out_struct)
                
                if length(obj.ana_out_struct(i).timings_array)>1
                    
                    fprintf(fid,['%%%%%%%% Analog : ',Adwin.Default_parameters.ana_out_name{i},' %%%%%%%%\n\n']);
                    
                end
                
                for j=1:length(obj.ana_out_struct(i).timings_array)-1
                    
                    if ~isempty(obj.ana_out_struct(i).timings_array(j).time_ref)
                        
                        fprintf(fid,['test_adwin.chge_state_ana(',num2str(i),',''',obj.name,''',',num2str(obj.ana_out_struct(i).timings_array(j).time_ref.ord),...
                            ',''',obj.ana_out_struct(i).timings_array(j).formula,''',''',obj.ana_out_struct(i).voltages_array(j).value_formula,''',''',obj.ana_out_struct(i).voltages_array(j).behaviour,''');\n\n']);
                        
                    else
                        
                        fprintf(fid,['test_adwin.chge_state_ana(',num2str(i),',''',obj.name,''',[],''',...
                            obj.ana_out_struct(i).timings_array(j).formula,''',''',obj.ana_out_struct(i).voltages_array(j).value_formula,''',''',obj.ana_out_struct(i).voltages_array(j).behaviour,''');\n\n']);
                        
                    end
                    
                end
                
                if ~strcmp(obj.ana_out_struct(i).voltages_array(end).value_formula,num2str(obj.ana_out_struct(i).voltages_array(end).value))
                    
                    if length(obj.ana_out_struct(i).timings_array)==1
                        
                        fprintf(fid,['%%%%%%%% Analog : ',Adwin.Default_parameters.ana_out_name{i},' %%%%%%%%\n\n']);
                        
                    end
                    
                    fprintf(fid,['test_adwin.chge_end_state_ana(',num2str(i),',''',obj.name,...
                        ''',''',obj.ana_out_struct(i).voltages_array(end).value_formula,''');\n\n']);
                    
                end
                
            end
            
        end
        
    end
    
end

